# 智能考试生成系统

这个系统可以自动处理多种文件格式（文档、PDF、图片、视频、音频），通过Python脚本进行智能处理和AI生成，自动创建高质量的考试题目。

## 🚀 功能特点

- 📤 **多格式文件上传**: 支持文档、PDF、图片、视频、音频等多种格式
- 🐍 **Python脚本集成**: 自动调用Python脚本进行文件处理
- 🤖 **AI智能生成**: 使用OpenAI API生成高质量选择题
- 🔍 **OCR文字识别**: 自动识别图片中的文字内容
- 🎵 **语音转文字**: 支持音频文件的语音识别
- 🎥 **视频处理**: 从视频中提取PPT内容和文字
- 📊 **自动监控**: 实时监控文件变化并自动处理
- 🌐 **API接口**: 提供完整的RESTful API
- ⚙️ **灵活配置**: 支持自定义配置和参数调整

## 📋 支持的文件类型

### 📄 文档类型
- `.txt` - 纯文本文件
- `.doc/.docx` - Microsoft Word文档
- `.ppt/.pptx` - PowerPoint演示文稿
- `.xls/.xlsx` - Excel电子表格

### 📑 PDF文件
- `.pdf` - PDF文档（自动文字提取）

### 🖼️ 图片类型
- `.jpg/.jpeg` - JPEG图片（OCR文字识别）
- `.png` - PNG图片（OCR文字识别）

### 🎥 视频类型
- `.mp4` - MP4视频（PPT检测和文字提取）
- `.avi` - AVI视频
- `.mov` - MOV视频
- `.mkv` - MKV视频

### 🎵 音频类型
- `.wav` - WAV音频（语音转文字）

## 🛠️ 安装依赖

### Node.js依赖
```bash
npm install express cors chokidar mysql2 multer
```

### Python依赖
```bash
pip install PyPDF2 easyocr textract chardet vosk openai
```

## 配置说明

配置文件位于`exam-converter-config.json`，包含以下配置项：

```json
{
  "db": {
    "host": "localhost",
    "port": 3306,
    "user": "root",
    "password": "123456",
    "database": "two hours"
  },
  "watchDir": "E:\\新建文件夹\\voicetotext\\voicetotext\\Quiz",
  "port": 3001,
  "examValidDays": 7,
  "defaultCourseId": 7,
  "defaultAuthorId": "stu023",
  "defaultExamType": 3,
  "defaultQuestionScore": 5
}
```

- `db`: 数据库配置
- `watchDir`: 监控的目录，存放题目TXT文件的文件夹
- `port`: API服务器端口
- `examValidDays`: 考试有效期（天）
- `defaultCourseId`: 默认课程ID
- `defaultAuthorId`: 默认作者ID
- `defaultExamType`: 默认考试类型
- `defaultQuestionScore`: 默认题目分数

## 🚀 使用方法

### 方法一：文件上传（推荐）

1. 启动服务器：
```bash
node txt-to-exam-converter.js
```

2. 打开测试页面：
```bash
# 在浏览器中打开
test-upload.html
```

3. 上传文件并生成考试：
   - 选择文件（支持多种格式）
   - 输入考试标题（可选）
   - 选择内容来源类型
   - 点击"上传并生成考试"

### 方法二：文件监控（传统方式）

1. 配置`exam-converter-config.json`文件
2. 运行脚本：
```bash
node txt-to-exam-converter.js
```
3. 将题目TXT文件放入监控目录，系统会自动解析并创建考试

### 测试集成

运行集成测试脚本：
```bash
node test-integration.js
```

## 支持的题目格式

### 文本格式

```
### 选择题
1. 测试题目
A. 选项A
B. 选项B
C. 选项C
D. 选项D
答案: A
```

### 表格格式（CSV/TSV）

```
题目ID,题目内容,选项A,选项B,选项C,选项D
1,这是一道测试题目,选项A,选项B(答案),选项C,选项D
```

## 🌐 API接口

### 考试管理
- `GET /api/Exam/getAutoGeneratedExams`: 获取自动生成的考试列表
- `GET /api/Exam/getExamDetails/:examId`: 获取指定考试的详情
- `DELETE /api/Exam/deleteExam/:examId`: 删除指定的考试

### 文件上传和处理
- `POST /api/Exam/uploadAndGenerate`: 上传文件并生成考试
  - 参数: `file` (文件), `title` (考试标题), `sourceType` (来源类型)
  - 返回: `{ flag: boolean, data: { examId: number }, message: string }`

### 系统信息
- `GET /api/Exam/getSupportedFileTypes`: 获取支持的文件类型列表
- `GET /api/health`: 系统健康检查

### 教师API
- `GET /api/teacher/*`: 教师相关的API接口（详见teacher-api.js）

## 前端集成

在前端项目的`StuExamTab.vue`文件中，添加以下方法来获取自动生成的考试：

```javascript
// 获取从txt文件自动生成的考试
getAutoGeneratedExams(){
    this.$axios.get("http://localhost:3001/api/Exam/getAutoGeneratedExams").then((res)=>{
        if(res.data.flag){
            // 将自动生成的考试添加到考试列表中
            const autoExams = res.data.data;
            if(autoExams && autoExams.length > 0) {
                // 合并考试数据
                this.examData = [...this.examData, ...autoExams];
                // 更新总数
                this.totalCount += autoExams.length;
            }
        }else{
            console.warn("自动生成的考试获取失败");
        }
    }).catch(err => {
        console.error("获取自动生成考试出错:", err);
    });
}
```

然后在`getExam`方法中调用它：

```javascript
getExam(){
    this.searchTitle["pageSize"]=this.pageSize;
    this.searchTitle["currentPage"]=this.currentPage;
    this.$axios.post("/Exam/getExam",this.searchTitle).then((res)=>{
        if(res.data.flag){
            /* 保存公告数据 */
            this.examData = res.data.data.records;
            
            // 查询从txt文件自动生成的考试
            this.getAutoGeneratedExams();
            
            /* 保存分页数据 */
            this.totalCount = res.data.data.total;
            this.currentPage = res.data.data.current;
            this.pageSize = res.data.data.size;
        }else{
            // 服务故障
            this.$message.error("信息获取失败！");
        }
    });
}
```
